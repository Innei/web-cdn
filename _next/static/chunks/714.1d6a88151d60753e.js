"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[714],{81538:function(d,b,a){a.r(b),a.d(b,{socketClient:function(){return x}});var e=a(67697),f=a(58298),g=a(88024),h=a(79461),i=a(87793),j=a(65280),k=a(94788),l=a(45631),m=a(41548),n=a(12464),o=a(23116),p=function(){var c=document.body,b=document.getElementById("dangmaku");if(!b){var a=document.createElement("div");return a.setAttribute("id","dangmaku"),a.style.cssText="\n      position: fixed;\n      top: 4rem;\n      bottom: 50vh;\n      z-index: -1;\n      overflow: hidden;\n      left: 0;\n      right: 0;\n    ",c.appendChild(a),a}return b},q=function(a){var c=a.color,g=a.duration,e=a.text,d=p(),f=d.getBoundingClientRect().height,b=document.createElement("div");Object.assign(b.style,{color:null!=c?c:"",position:"absolute",fontSize:"16px",top:"".concat(14*(0,o.Z)((0,n.Z)(0,f>>8)),"px")}),Object.assign(b,{textContent:e,onanimationend:function(a){b.remove()}}),d.appendChild(b),requestAnimationFrame(function(){b.style.animation="dangmaku ".concat(g&&g/1e3>8?g:8,"s steps(30) ")})},c=a(70623);function r(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var s=c.q.shared,t=function(f,a){var c,d=(null===(A=window.data)|| void 0===A?void 0:A.aggregateData.seo.title)||"Kami",w=(null===(B=window.data)|| void 0===B?void 0:B.aggregateData.url.webUrl.replace(/\/$/,""))||(null==globalThis?void 0:globalThis.location.host)||"",x=m.h.gatewayStore,y=m.h.noteStore,g=m.h.postStore,b=m.h.userStore,i=m.h.pageStore;switch(f){case l.G.VISITOR_ONLINE:case l.G.VISITOR_OFFLINE:var z=a.online;(0,j.z)(function(){x.online=z});break;case l.G.RECENTLY_CREATE:s.notice({title:d,text:"\u7AD9\u957F\u53D1\u5E03\u4E00\u6761\u65B0\u52A8\u6001",description:a.content,onclick:function(){window.open("".concat(w,"/recently"))}});break;case l.G.POST_CREATE:case l.G.NOTE_CREATE:if(a.hide)break;var A,B,e,n=u("\u6587\u7AE0",a.title),C=(r(e={},l.G.POST_CREATE,"post"),r(e,l.G.NOTE_CREATE,"note"),e);s.notice({title:d,text:n,description:v(a.text),onclick:function(){window.open(w+("post"===C[f]?"/posts/".concat(a.category.slug,"/").concat(a.slug):"/notes/".concat(a.nid)))}});break;case l.G.SAY_CREATE:m.h.sayStore.add(a);var o=u("\u8BF4\u8BF4");s.notice({title:d,text:o,description:v(a.text),onclick:function(){window.open("".concat(w,"/says"))}});break;case l.G.SAY_DELETE:var p=a;m.h.sayStore.remove(p);break;case l.G.COMMENT_CREATE:m.h.commentStore.addComment(a);break;case l.G.DANMAKU_CREATE:q({text:"".concat(a.author,": ").concat(a.text),color:a.color}),a.author!=b.name&&a.author!=b.username||b.isLogged||s.notice({title:"".concat(b.name," \u6572\u4E86\u4F60\u4E00\u4E0B"),text:a.text,options:{image:null===(c=b.master)|| void 0===c?void 0:c.avatar}});break;case l.G.POST_UPDATE:g.addAndPatch(a);break;case l.G.POST_DELETE:var t=a;g.softDelete(t);break;case l.G.NOTE_UPDATE:(0,j.z)(function(){y.addAndPatch(a);var b=y.get(a.id);b&&b.hide&&!m.h.userStore.isLogged&&(b.title="\u5DF2\u9690\u85CF",b.text="\u8BE5\u7B14\u8BB0\u5DF2\u88AB\u9690\u85CF")});break;case l.G.NOTE_DELETE:var D=a;(0,j.z)(function(){y.softDelete(D);var a=y.get(D);a&&(a.title="\u5DF2\u5220\u9664",a.text="\u8BE5\u7B14\u8BB0\u5DF2\u88AB\u5220\u9664")});break;case l.G.PAGE_UPDATED:k.yw.info("\u9875\u9762\u5185\u5BB9\u5DF2\u66F4\u65B0"),i.addAndPatch(a);break;default:h.r8&&console.log(f,a)}};function u(b,a){return"".concat(m.h.userStore.name,"\u53D1\u5E03\u4E86\u65B0\u7684").concat(b).concat(a?": ".concat(a):"")}function v(a){return a.length>20?"".concat(a.slice(0,20),"..."):a}function w(d,c){for(var b=0;b<c.length;b++){var a=c[b];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}var x=new(function(){"use strict";var a,b,c;function d(){var a,b,c;!function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}(this,d),a=this,c=void 0,(b="socket")in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,this.socket=(0,e.io)("".concat(g.j,"/web"),{timeout:1e4,reconnectionDelay:3e3,autoConnect:!1,reconnectionAttempts:3,transports:["websocket"]})}return a=d,b=[{key:"initIO",value:function(){var a=this;this.socket&&(this.socket.close(),this.socket.open(),this.socket.on("message",function(b){if("string"!=typeof b)return a.handleEvent(b.type,(0,f.U)(b.data,{deep:!0}));var c=JSON.parse(b),d=c.data,e=c.type;a.handleEvent(e,(0,f.U)(d,{deep:!0}))}))}},{key:"reconnect",value:function(){this.socket.open()}},{key:"handleEvent",value:function(b,a){h.r8&&console.log(a),i.Y.emit(b,a),t(b,a)}},{key:"emit",value:function(a,b){var c=this;return new Promise(function(d){c.socket&&c.socket.connected&&c.socket.emit(a,b,function(a){d(a)})})}}],w(a.prototype,b),c&&w(a,c),d}())},12464:function(c,b,a){a.d(b,{Z:function(){return k}});var d=Math.ceil,e=Math.max,f=function(a,g,c,h){for(var i=-1,b=e(d((g-a)/(c||1)),0),f=Array(b);b--;)f[h?b:++i]=a,a+=c;return f},g=a(61833),h=a(28106),i=1/0,j=function(a){return a?(a=(0,h.Z)(a))===i||a=== -i?(a<0?-1:1)*17976931348623157e292:a==a?a:0:0===a?a:0},k=function(c,a,b){return b&&"number"!=typeof b&&(0,g.Z)(c,a,b)&&(a=b=void 0),c=j(c),void 0===a?(a=c,c=0):a=j(a),b=void 0===b?c<a?1:-1:j(b),f(c,a,b,void 0)}},11530:function(d,b,a){a.d(b,{YD:function(){return m}});var c=a(50959);function e(){return(e=Object.assign||function(d){for(var a=1;a<arguments.length;a++){var b=arguments[a];for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(d[c]=b[c])}return d}).apply(this,arguments)}let f=new Map,g=new WeakMap,h=0,i;function j(a,j,b={},c=i){if(void 0===window.IntersectionObserver&& void 0!==c){let d=a.getBoundingClientRect();return j(c,{isIntersecting:c,target:a,intersectionRatio:"number"==typeof b.threshold?b.threshold:0,time:0,boundingClientRect:d,intersectionRect:d,rootBounds:d}),()=>{}}let{id:m,observer:l,elements:e}=function(a){var d;let c=(d=a,Object.keys(d).sort().filter(a=>void 0!==d[a]).map(b=>{var a;return`${b}_${"root"===b?(a=d.root)?(g.has(a)||(h+=1,g.set(a,h.toString())),g.get(a)):"0":d[b]}`}).toString()),b=f.get(c);if(!b){let i=new Map,j,e=new IntersectionObserver(b=>{b.forEach(b=>{var c;let d=b.isIntersecting&&j.some(a=>b.intersectionRatio>=a);a.trackVisibility&& void 0===b.isVisible&&(b.isVisible=d),null==(c=i.get(b.target))||c.forEach(a=>{a(d,b)})})},a);j=e.thresholds||(Array.isArray(a.threshold)?a.threshold:[a.threshold||0]),b={id:c,observer:e,elements:i},f.set(c,b)}return b}(b),k=e.get(a)||[];return e.has(a)||e.set(a,k),k.push(j),l.observe(a),function(){k.splice(k.indexOf(j),1),0===k.length&&(e.delete(a),l.unobserve(a)),0===e.size&&(l.disconnect(),f.delete(m))}}function k(a){return"function"!=typeof a.children}class l extends c.Component{constructor(a){super(a),this.node=null,this._unobserveCb=null,this.handleNode=a=>{!this.node||(this.unobserve(),a||this.props.triggerOnce||this.props.skip||this.setState({inView:!!this.props.initialInView,entry:void 0})),this.node=a||null,this.observeNode()},this.handleChange=(a,b)=>{a&&this.props.triggerOnce&&this.unobserve(),k(this.props)||this.setState({inView:a,entry:b}),this.props.onChange&&this.props.onChange(a,b)},this.state={inView:!!a.initialInView,entry:void 0}}componentDidUpdate(a){(a.rootMargin!==this.props.rootMargin||a.root!==this.props.root||a.threshold!==this.props.threshold||a.skip!==this.props.skip||a.trackVisibility!==this.props.trackVisibility||a.delay!==this.props.delay)&&(this.unobserve(),this.observeNode())}componentWillUnmount(){this.unobserve(),this.node=null}observeNode(){if(!this.node||this.props.skip)return;let{threshold:a,root:b,rootMargin:c,trackVisibility:d,delay:e,fallbackInView:f}=this.props;this._unobserveCb=j(this.node,this.handleChange,{threshold:a,root:b,rootMargin:c,trackVisibility:d,delay:e},f)}unobserve(){this._unobserveCb&&(this._unobserveCb(),this._unobserveCb=null)}render(){if(!k(this.props)){let{inView:b,entry:c}=this.state;return this.props.children({inView:b,entry:c,ref:this.handleNode})}let a=this.props,{children:d,as:f}=a,g=function(c,f){if(null==c)return{};var a,b,d={},e=Object.keys(c);for(b=0;b<e.length;b++)a=e[b],null.indexOf(a)>=0||(d[a]=c[a]);return d}(a,null);return React.createElement(f||"div",e({ref:this.handleNode},g),d)}}function m({threshold:b,delay:e,trackVisibility:f,rootMargin:g,root:h,triggerOnce:i,skip:k,initialInView:l,fallbackInView:m,onChange:n}={}){let q=c.useRef(),o=c.useRef(),[d,r]=c.useState({inView:!!l});o.current=n;let p=c.useCallback(a=>{void 0!==q.current&&(q.current(),q.current=void 0),!k&&a&&(q.current=j(a,(b,a)=>{r({inView:b,entry:a}),o.current&&o.current(b,a),a.isIntersecting&&i&&q.current&&(q.current(),q.current=void 0)},{root:h,rootMargin:g,threshold:b,trackVisibility:f,delay:e},m))},[Array.isArray(b)?b.toString():b,h,g,i,k,f,m,e]);c.useEffect(()=>{q.current||!d.entry||i||k||r({inView:!!l})});let a=[p,d.inView,d.entry];return a.ref=a[0],a.inView=a[1],a.entry=a[2],a}}}])