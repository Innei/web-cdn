{"version":3,"sources":["webpack://_N_E/./node_modules/next/dist/build/webpack/loaders/next-client-pages-loader.js?53c2","webpack://_N_E/./components/NumberRecorder/index.tsx","webpack://_N_E/./components/Action/index.tsx","webpack://_N_E/./components/Action/index.module.scss?f9f8","webpack://_N_E/./components/Copyright/index.module.scss?aac9","webpack://_N_E/./components/Outdate/index.tsx","webpack://_N_E/./components/Copyright/index.tsx","webpack://_N_E/./pages/posts/[category]/[slug].tsx","webpack://_N_E/./components/NumberRecorder/index.module.scss?eb6b"],"names":["window","__NEXT_P","push","NumberRecorder","props","number","n","setN","useState","numbersRef","useRef","useEffect","current","animate","transform","duration","easing","onfinish","className","styles","style","width","toString","length","ref","memo","actions","informs","copyright","rest","map","inform","index","key","icon","color","name","href","target","title","faCreativeCommons","minHeight","action","i","cursor","onClick","callback","module","exports","time","relative","relativeTimeFromNow","dayjs","diff","Copyright","link","date","copy","isThumbsUpBefore","id","Cookie","get","PostView","text","_id","userStore","useStore","setAction","copyrightInfo","setCopyright","description","summary","getSummaryFromMd","slice","thumbsUp","setThumbsUp","count","like","scrollTo","top","behavior","faUser","faCalendar","created","format","faHashtag","category","tags","join","faBookOpen","read","faCoffee","open","configs","donate","faThumbsUp","undefined","error","Rest","params","then","success","set","expires","storeThumbsUpCookie","appStore","headerNav","meta","show","modified","URL","location","pathname","url","ArticleLayout","openGraph","profile","username","master","article","publishedTime","modifiedTime","section","Outdate","ImageSizes","Provider","value","images","escapeHtml","showTOC","Action","Comment","type","allowComment","getInitialProps","async","query","ctx","slug","data","observer"],"mappings":"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","file":"static/chunks/pages/posts/[category]/[slug]-1f4d76a498743ba24e73.module.js","sourcesContent":["\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/posts/[category]/[slug]\",\n      function () {\n        return require(\"private-next-pages/posts/[category]/[slug].tsx\");\n      }\n    ]);\n  ","import { FC, useEffect, useRef, useState } from 'react'\nimport styles from './index.module.scss'\n\ninterface NumberRecorderProps {\n  number: number\n}\n\nconst NumberRecorder: FC<NumberRecorderProps> = (props) => {\n  const { number } = props\n  const [n, setN] = useState(number)\n  const numbersRef = useRef<HTMLDivElement>(null)\n  useEffect(() => {\n    if (!numbersRef.current || n === number) {\n      return\n    }\n\n    const animate = numbersRef.current.animate(\n      [\n        {\n          transform: 'translateY(-1em)',\n        },\n        {\n          transform: `translateY(${number === n + 1 ? -2 : 0}em)`,\n        },\n      ],\n      { duration: 500, easing: 'cubic-bezier(0.34, 1.56, 0.64, 1)' },\n    )\n\n    animate.onfinish = () => {\n      setN(number)\n    }\n  }, [n, number])\n\n  return (\n    <div\n      className={styles['recorder']}\n      style={{ width: `${n.toString().length}em` }}\n    >\n      <div className={styles['numbers']} ref={numbersRef}>\n        {n - 1 < 0 ? <span></span> : <span>{n - 1}</span>}\n        <span>{n}</span>\n        <span>{n + 1}</span>\n      </div>\n    </div>\n  )\n}\n\nexport { NumberRecorder }\n","import {\n  faCreativeCommons,\n  IconDefinition,\n} from '@fortawesome/free-brands-svg-icons'\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { DetailedHTMLProps, HTMLAttributes, memo } from 'react'\nimport styles from './index.module.scss'\n\ntype BaseAction = {\n  icon: IconDefinition\n  name: string | number | JSX.Element\n  color?: string\n}\n\nexport interface ActionProps\n  extends DetailedHTMLProps<HTMLAttributes<HTMLDivElement>, HTMLDivElement> {\n  informs?: BaseAction[]\n  actions?: (BaseAction & {\n    callback: () => void\n  })[]\n  copyright?: boolean\n}\n\nexport default memo(function Action(props: ActionProps) {\n  const { actions = [], informs = [], copyright = true, ...rest } = props\n\n  return (\n    <>\n      <div className=\"note-inform\" {...rest}>\n        {informs.map((inform, index) => {\n          return (\n            <span key={index}>\n              <FontAwesomeIcon\n                icon={inform.icon}\n                className={styles.icon}\n                color={inform.color}\n              />\n              {inform.name}\n            </span>\n          )\n        })}\n\n        {copyright && (\n          <a\n            href=\"https://creativecommons.org/licenses/by-nc-nd/4.0/\"\n            style={{ color: 'currentColor' }}\n            // eslint-disable-next-line react/jsx-no-target-blank\n            target={'_blank'}\n          >\n            <span title={'创作共用保留署名-非商业-禁止演绎4.0国际许可证'}>\n              <FontAwesomeIcon\n                icon={faCreativeCommons}\n                className={styles.icon}\n              />\n            </span>\n          </a>\n        )}\n      </div>\n      <div className=\"note-action\" style={{ minHeight: '1rem' }}>\n        {actions.map((action, i) => {\n          return (\n            <span\n              key={i}\n              style={{ cursor: 'pointer' }}\n              onClick={action.callback}\n            >\n              <FontAwesomeIcon\n                icon={action.icon}\n                className={styles.icon}\n                color={action.color}\n              />\n              {action.name}\n            </span>\n          )\n        })}\n      </div>\n    </>\n  )\n})\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"icon\":\"Action_icon__3BtwG\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"copyright-session\":\"Copyright_copyright-session__3Q0fD\"};","import dayjs from 'dayjs'\nimport { relativeTimeFromNow } from 'utils/time'\n\nexport default (function OutdateNotice({ time }: { time: string | Date }) {\n  const relative = relativeTimeFromNow(time)\n\n  return dayjs().diff(dayjs(time), 'day') > 60 ? (\n    <blockquote>\n      这篇文章上次修改于 {relative}\n      ，可能其部分内容已经发生变化，如有疑问可询问作者。\n    </blockquote>\n  ) : null\n})\n","import { FC, memo } from 'react'\nimport { copy } from '../../utils/dom'\nimport styles from './index.module.scss'\n\nexport interface CopyrightProps {\n  title: string\n  link: string\n  date: string\n}\n\nexport const Copyright: FC<CopyrightProps> = memo((props) => {\n  const { title, link, date } = props\n\n  return (\n    <section className={styles['copyright-session']}>\n      <p>文章标题: {title}</p>\n      <p>\n        文章链接: <span>{link}</span>{' '}\n        <a\n          onClick={() => {\n            copy(link)\n          }}\n        >\n          [复制]\n        </a>\n      </p>\n      <p>最后修改时间: {date}</p>\n      <hr />\n      <div>\n        <p>\n          商业转载请联系站长获得授权，非商业转载请注明本文出处及文章链接，未经站长允许不得对文章文字内容进行修改演绎。\n          <br />\n          本文采用\n          <a href=\"https://creativecommons.org/licenses/by-nc-nd/4.0/\">\n            创作共用保留署名-非商业-禁止演绎4.0国际许可证\n          </a>\n        </p>\n      </div>\n    </section>\n  )\n})\n","import {\n  faBookOpen,\n  faCalendar,\n  faCoffee,\n  faHashtag,\n  faThumbsUp,\n  faUser,\n} from '@fortawesome/free-solid-svg-icons'\nimport { message } from 'antd'\nimport { useStore } from 'common/store'\nimport Action, { ActionProps } from 'components/Action'\nimport { CommentLazy } from 'components/Comment'\nimport Markdown from 'components/MD-render'\nimport OutdateNotice from 'components/Outdate'\nimport dayjs from 'dayjs'\nimport { ArticleLayout } from 'layouts/ArticleLayout'\nimport { observer } from 'mobx-react'\nimport { PostResModel, PostSingleDto } from 'models/post'\nimport { NextPage, NextPageContext } from 'next/'\nimport React, { useEffect, useState } from 'react'\nimport { Rest } from 'utils/api'\nimport { ImageSizesContext } from '../../../common/context/ImageSizes'\nimport { Copyright, CopyrightProps } from '../../../components/Copyright'\nimport { Seo } from '../../../components/SEO'\nimport configs from '../../../configs'\nimport { getSummaryFromMd } from '../../../utils'\nimport Cookie from 'js-cookie'\nimport { NumberRecorder } from 'components/NumberRecorder'\n\nconst ThumbsUpPrefix = 'THUMBSUP_'\nconst storeThumbsUpCookie = (id: string) => {\n  const key = `${ThumbsUpPrefix}${id}`\n  Cookie.set(key, id, { expires: 1 })\n}\nconst isThumbsUpBefore = (id: string) => {\n  const key = `${ThumbsUpPrefix}${id}`\n  return !!Cookie.get(key)\n}\nexport const PostView: NextPage<PostResModel> = (props) => {\n  const { text, title, _id } = props\n  const { userStore } = useStore()\n  const name = userStore.name\n  const [actions, setAction] = useState({} as ActionProps)\n  const [copyrightInfo, setCopyright] = useState({} as CopyrightProps)\n  const description =\n    props.summary ?? getSummaryFromMd(props.text).slice(0, 150)\n  const [thumbsUp, setThumbsUp] = useState(props.count?.like || 0)\n\n  useEffect(() => {\n    setThumbsUp(props.count?.like || 0)\n\n    window.scrollTo({ top: 0, behavior: 'smooth' })\n  }, [props])\n  useEffect(() => {\n    setAction({\n      informs: [\n        {\n          icon: faUser,\n          name: name as string,\n        },\n        {\n          icon: faCalendar,\n          name: dayjs(props.created).format('YY/MM/DD H:mm'),\n        },\n        {\n          icon: faHashtag,\n          name:\n            props.category.name +\n            `${\n              props.tags && props.tags.length > 0\n                ? '[' + props.tags.join('-') + ']'\n                : ''\n            }`,\n        },\n        {\n          icon: faBookOpen,\n          name: props.count.read ?? 0,\n        },\n      ],\n      actions: [\n        {\n          icon: faCoffee,\n          name: '',\n          callback: () => {\n            window.open(configs.donate)\n          },\n        },\n        {\n          icon: faThumbsUp,\n          name: <NumberRecorder number={thumbsUp || 0} />,\n          color: isThumbsUpBefore(props._id) ? '#f1c40f' : undefined,\n          callback: () => {\n            if (isThumbsUpBefore(props._id)) {\n              return message.error('你已经支持过啦!')\n            }\n            Rest('Post')\n              .get('_thumbs-up', {\n                params: {\n                  id: props._id,\n                },\n              })\n              .then(() => {\n                message.success('感谢支持!')\n                storeThumbsUpCookie(props._id)\n                setThumbsUp(thumbsUp + 1)\n              })\n          },\n        },\n      ],\n      copyright: props.copyright,\n    })\n  }, [name, props, thumbsUp])\n  const { appStore } = useStore()\n\n  useEffect(() => {\n    appStore.headerNav = {\n      title: props.title,\n      meta: props.category.name,\n      show: true,\n    }\n    return () => {\n      appStore.headerNav.show = false\n    }\n  }, [appStore, props.category.name, props.title])\n\n  useEffect(() => {\n    if (props.copyright) {\n      setCopyright({\n        date: dayjs(props.modified).format('YYYY年MM月DD日 H:mm'),\n        title,\n        link: new URL(location.pathname, configs.url).toString(),\n      })\n    }\n  }, [props, title])\n\n  return (\n    <ArticleLayout title={title}>\n      <Seo\n        title={props.title}\n        description={description}\n        openGraph={{\n          profile: { username: userStore.master.name },\n          article: {\n            publishedTime: props.created,\n            modifiedTime: props.modified,\n            section: props.category.name,\n          },\n        }}\n      />\n\n      <OutdateNotice time={props.modified} />\n      <ImageSizesContext.Provider value={props.images}>\n        <Markdown value={text} escapeHtml={false} showTOC={true} />\n      </ImageSizesContext.Provider>\n      {props.copyright ? <Copyright {...copyrightInfo} /> : null}\n      <Action {...actions} />\n\n      <CommentLazy\n        type={'Post'}\n        id={_id}\n        allowComment={props.allowComment ?? true}\n      />\n    </ArticleLayout>\n  )\n}\n\nPostView.getInitialProps = async (ctx: NextPageContext) => {\n  const { query } = ctx\n  const { category, slug } = query\n  const { data } = (await Rest('Post', category as string).get(\n    slug as string,\n  )) as PostSingleDto\n\n  return { ...data }\n}\n\nexport default observer(PostView)\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"recorder\":\"NumberRecorder_recorder__3RxBH\",\"numbers\":\"NumberRecorder_numbers__2L9ZB\"};"],"sourceRoot":""}